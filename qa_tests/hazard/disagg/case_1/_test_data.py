# Copyright (c) 2010-2012, GEM Foundation.
#
# OpenQuake is free software: you can redistribute it and/or modify it
# under the terms of the GNU Affero General Public License as published
# by the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# OpenQuake is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with OpenQuake.  If not, see <http://www.gnu.org/licenses/>.

import numpy

#: Shape of the result matrices (which are numpy arrays)
SHAPE = (3, 4, 2, 1, 3, 1)

RLZ_1_POE_002_PGA = numpy.array([
    0.14641063852945735,
    0.5600625525575187,
    0.17238164158304325,
    0.0,
    0.0,
    0.0,
    0.08701189761982031,
    0.9470841416687783,
    0.5826588709956738,
    0.0,
    0.0,
    0.0,
    0.00864197934872879,
    0.82015924054357,
    0.6241177733278533,
    0.0,
    0.0,
    0.0,
    0.0,
    0.22290337063911414,
    0.41990824937006155,
    0.0,
    0.0,
    0.0,
    0.021340651586741588,
    0.0893726873941495,
    0.02134126874014708,
    0.0,
    0.0,
    0.0,
    0.09159373062552667,
    0.37214770599490576,
    0.10169811912093052,
    0.0,
    0.0,
    0.0,
    0.04201515773158493,
    0.3291679730844548,
    0.08951595702988568,
    0.0,
    0.0,
    0.0,
    0.0001017457283049028,
    0.18426380133612785,
    0.05947388881872173,
    0.0,
    0.0,
    0.0,
    0.00387033305138329,
    0.016688622666190533,
    0.00387033305138329,
    0.0,
    0.0,
    0.0,
    0.003070293000004387,
    0.01327650755285592,
    0.0030749255345193793,
    0.0,
    0.0,
    0.0,
    0.006598908656912261,
    0.030925231284481547,
    0.007212169391551448,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
]).reshape(SHAPE)

RLZ_2_POE_002_PGA = numpy.array([
    0.14641063852945735,
    0.5600625525575187,
    0.17238164158304325,
    0.0,
    0.0,
    0.0,
    0.08701189761982031,
    0.9470841416687783,
    0.5826588709956738,
    0.0,
    0.0,
    0.0,
    0.00864197934872879,
    0.82015924054357,
    0.6241177733278533,
    0.0,
    0.0,
    0.0,
    0.0,
    0.22290337063911414,
    0.41990824937006155,
    0.0,
    0.0,
    0.0,
    0.021340651586741588,
    0.0893726873941495,
    0.02134126874014708,
    0.0,
    0.0,
    0.0,
    0.09159373062552667,
    0.37214770599490576,
    0.10169811912093052,
    0.0,
    0.0,
    0.0,
    0.04201515773158493,
    0.3291679730844548,
    0.08951595702988568,
    0.0,
    0.0,
    0.0,
    0.0001017457283049028,
    0.18426380133612785,
    0.05947388881872173,
    0.0,
    0.0,
    0.0,
    0.00387033305138329,
    0.016688622666190533,
    0.00387033305138329,
    0.0,
    0.0,
    0.0,
    0.003070293000004387,
    0.01327650755285592,
    0.0030749255345193793,
    0.0,
    0.0,
    0.0,
    0.006598908656912261,
    0.030925231284481547,
    0.007212169391551448,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
]).reshape(SHAPE)

RLZ_1_POE_002_SA = numpy.array([
    0.15555896892717958,
    0.5600625525575187,
    0.17238164158304325,
    0.0,
    0.0,
    0.0,
    0.12855029109748028,
    0.9600142303196018,
    0.5826588709956738,
    0.0,
    0.0,
    0.0,
    0.01969659731101392,
    0.8802830829472604,
    0.630147383780127,
    0.0,
    0.0,
    0.0,
    0.0,
    0.31979412525834794,
    0.47647575045829005,
    0.0,
    0.0,
    0.0,
    0.02134126874014708,
    0.0893726873941495,
    0.02134126874014708,
    0.0,
    0.0,
    0.0,
    0.09528846890316212,
    0.37214770599490576,
    0.10169811912093052,
    0.0,
    0.0,
    0.0,
    0.05303261688986738,
    0.33215820690093745,
    0.08951595702988568,
    0.0,
    0.0,
    0.0,
    0.0018993380858484121,
    0.2025976082969453,
    0.05947388881872173,
    0.0,
    0.0,
    0.0,
    0.00387033305138329,
    0.016688622666190533,
    0.00387033305138329,
    0.0,
    0.0,
    0.0,
    0.003073948754934719,
    0.01327650755285592,
    0.0030749255345193793,
    0.0,
    0.0,
    0.0,
    0.006843053070766936,
    0.030925231284481547,
    0.007212169391551448,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
]).reshape(SHAPE)

RLZ_2_POE_002_SA = numpy.array([
    0.15555896892717958,
    0.5600625525575187,
    0.17238164158304325,
    0.0,
    0.0,
    0.0,
    0.12855029109748028,
    0.9600142303196018,
    0.5826588709956738,
    0.0,
    0.0,
    0.0,
    0.01969659731101392,
    0.8802830829472604,
    0.630147383780127,
    0.0,
    0.0,
    0.0,
    0.0,
    0.31979412525834794,
    0.47647575045829005,
    0.0,
    0.0,
    0.0,
    0.02134126874014708,
    0.0893726873941495,
    0.02134126874014708,
    0.0,
    0.0,
    0.0,
    0.09528846890316212,
    0.37214770599490576,
    0.10169811912093052,
    0.0,
    0.0,
    0.0,
    0.05303261688986738,
    0.33215820690093745,
    0.08951595702988568,
    0.0,
    0.0,
    0.0,
    0.0018993380858484121,
    0.2025976082969453,
    0.05947388881872173,
    0.0,
    0.0,
    0.0,
    0.00387033305138329,
    0.016688622666190533,
    0.00387033305138329,
    0.0,
    0.0,
    0.0,
    0.003073948754934719,
    0.01327650755285592,
    0.0030749255345193793,
    0.0,
    0.0,
    0.0,
    0.006843053070766936,
    0.030925231284481547,
    0.007212169391551448,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
]).reshape(SHAPE)

RLZ_1_POE_01_PGA = numpy.array([
    0.07858572714210599,
    0.5393414531689162,
    0.17238164158304325,
    0.0,
    0.0,
    0.0,
    0.001274635309090777,
    0.7232415581411662,
    0.5753019778803283,
    0.0,
    0.0,
    0.0,
    0.0,
    0.29956039475844976,
    0.48746207585153356,
    0.0,
    0.0,
    0.0,
    0.0,
    0.002908119960282396,
    0.14470305609322964,
    0.0,
    0.0,
    0.0,
    0.020676022513711256,
    0.0893726873941495,
    0.02134126874014708,
    0.0,
    0.0,
    0.0,
    0.041658155068586056,
    0.3612784068432515,
    0.10169811912093052,
    0.0,
    0.0,
    0.0,
    0.0013608730458650742,
    0.24087436960788156,
    0.08951595702988568,
    0.0,
    0.0,
    0.0,
    0.0,
    0.05083882281449714,
    0.05947388881872173,
    0.0,
    0.0,
    0.0,
    0.0038684613787252076,
    0.016688622666190533,
    0.00387033305138329,
    0.0,
    0.0,
    0.0,
    0.002762251420166506,
    0.01327650755285592,
    0.0030749255345193793,
    0.0,
    0.0,
    0.0,
    0.0026723185542567585,
    0.029481706161797128,
    0.007212169391551448,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
]).reshape(SHAPE)

RLZ_2_POE_01_PGA = numpy.array([
    0.07858572714210599,
    0.5393414531689162,
    0.17238164158304325,
    0.0,
    0.0,
    0.0,
    0.001274635309090777,
    0.7232415581411662,
    0.5753019778803283,
    0.0,
    0.0,
    0.0,
    0.0,
    0.29956039475844976,
    0.48746207585153356,
    0.0,
    0.0,
    0.0,
    0.0,
    0.002908119960282396,
    0.14470305609322964,
    0.0,
    0.0,
    0.0,
    0.020676022513711256,
    0.0893726873941495,
    0.02134126874014708,
    0.0,
    0.0,
    0.0,
    0.041658155068586056,
    0.3612784068432515,
    0.10169811912093052,
    0.0,
    0.0,
    0.0,
    0.0013608730458650742,
    0.24087436960788156,
    0.08951595702988568,
    0.0,
    0.0,
    0.0,
    0.0,
    0.05083882281449714,
    0.05947388881872173,
    0.0,
    0.0,
    0.0,
    0.0038684613787252076,
    0.016688622666190533,
    0.00387033305138329,
    0.0,
    0.0,
    0.0,
    0.002762251420166506,
    0.01327650755285592,
    0.0030749255345193793,
    0.0,
    0.0,
    0.0,
    0.0026723185542567585,
    0.029481706161797128,
    0.007212169391551448,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
]).reshape(SHAPE)

RLZ_1_POE_01_SA = numpy.array([
    0.09147830350623831,
    0.5495027155652494,
    0.17238164158304325,
    0.0,
    0.0,
    0.0,
    0.0036612458052496244,
    0.8056170314465245,
    0.5811494420080706,
    0.0,
    0.0,
    0.0,
    0.0,
    0.41316182997862505,
    0.5356508881896369,
    0.0,
    0.0,
    0.0,
    0.0,
    0.012516747839925402,
    0.1979147923484298,
    0.0,
    0.0,
    0.0,
    0.020943707460027938,
    0.0893726873941495,
    0.02134126874014708,
    0.0,
    0.0,
    0.0,
    0.052325511844044104,
    0.36674789106188255,
    0.10169811912093052,
    0.0,
    0.0,
    0.0,
    0.004088854410586706,
    0.26634376230379586,
    0.08951595702988568,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0745946181248427,
    0.05947388881872173,
    0.0,
    0.0,
    0.0,
    0.003870025005146438,
    0.016688622666190533,
    0.00387033305138329,
    0.0,
    0.0,
    0.0,
    0.002878185771145847,
    0.01327650755285592,
    0.0030749255345193793,
    0.0,
    0.0,
    0.0,
    0.003168679256657647,
    0.030468278554500294,
    0.007212169391551448,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
]).reshape(SHAPE)

RLZ_2_POE_01_SA = numpy.array([
    0.09147830350623831,
    0.5495027155652494,
    0.17238164158304325,
    0.0,
    0.0,
    0.0,
    0.0036612458052496244,
    0.8056170314465245,
    0.5811494420080706,
    0.0,
    0.0,
    0.0,
    0.0,
    0.41316182997862505,
    0.5356508881896369,
    0.0,
    0.0,
    0.0,
    0.0,
    0.012516747839925402,
    0.1979147923484298,
    0.0,
    0.0,
    0.0,
    0.020943707460027938,
    0.0893726873941495,
    0.02134126874014708,
    0.0,
    0.0,
    0.0,
    0.052325511844044104,
    0.36674789106188255,
    0.10169811912093052,
    0.0,
    0.0,
    0.0,
    0.004088854410586706,
    0.26634376230379586,
    0.08951595702988568,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0745946181248427,
    0.05947388881872173,
    0.0,
    0.0,
    0.0,
    0.003870025005146438,
    0.016688622666190533,
    0.00387033305138329,
    0.0,
    0.0,
    0.0,
    0.002878185771145847,
    0.01327650755285592,
    0.0030749255345193793,
    0.0,
    0.0,
    0.0,
    0.003168679256657647,
    0.030468278554500294,
    0.007212169391551448,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
]).reshape(SHAPE)

#: In this test case, we test the export of a single result.
#: This is the expected XML output.
EXPECTED_XML_DISAGG = """\
<?xml version='1.0' encoding='UTF-8'?>
<nrml xmlns:gml="http://www.opengis.net/gml" xmlns="http://openquake.org/xmlns/nrml/0.4">
  <disaggMatrices sourceModelTreePath="b1" gsimTreePath="b1" IMT="SA" investigationTime="50.0" saPeriod="0.025" saDamping="5.0" lon="10.1" lat="40.1" magBinEdges="5.0, 6.0, 7.0, 8.0" distBinEdges="0.0, 25.0, 50.0, 75.0, 100.0" lonBinEdges="9.0, 10.5, 12.0" latBinEdges="39.0, 40.5" epsBinEdges="-3.0, -1.0, 1.0, 3.0" tectonicRegionTypes="Active Shallow Crust">
    <disaggMatrix type="Mag" dims="3" poE="0.1" iml="0.0311513188906">
      <prob index="0" value="0.994069447605"/>
      <prob index="1" value="0.727650754029"/>
      <prob index="2" value="0.0817323260609"/>
    </disaggMatrix>
    <disaggMatrix type="Dist" dims="4" poE="0.1" iml="0.0311513188906">
      <prob index="0" value="0.711623309084"/>
      <prob index="1" value="0.95710677702"/>
      <prob index="2" value="0.826064326781"/>
      <prob index="3" value="0.310628819374"/>
    </disaggMatrix>
    <disaggMatrix type="TRT" dims="1" poE="0.1" iml="0.0311513188906">
      <prob index="0" value="0.998516831066"/>
    </disaggMatrix>
    <disaggMatrix type="Mag,Dist" dims="3,4" poE="0.1" iml="0.0311513188906">
      <prob index="0,0" value="0.661266931474"/>
      <prob index="0,1" value="0.918880674326"/>
      <prob index="0,2" value="0.727502216974"/>
      <prob index="0,3" value="0.207954290639"/>
      <prob index="1,0" value="0.127471522835"/>
      <prob index="1,1" value="0.460913888538"/>
      <prob index="1,2" value="0.334748984915"/>
      <prob index="1,3" value="0.129632074919"/>
      <prob index="2,0" value="0.0242850764891"/>
      <prob index="2,1" value="0.0191418496242"/>
      <prob index="2,2" value="0.0405106838561"/>
      <prob index="2,3" value="0.0"/>
    </disaggMatrix>
    <disaggMatrix type="Mag,Dist,Eps" dims="3,4,3" poE="0.1" iml="0.0311513188906">
      <prob index="0,0,0" value="0.0914783035062"/>
      <prob index="0,0,1" value="0.549502715565"/>
      <prob index="0,0,2" value="0.172381641583"/>
      <prob index="0,1,0" value="0.00366124580525"/>
      <prob index="0,1,1" value="0.805617031447"/>
      <prob index="0,1,2" value="0.581149442008"/>
      <prob index="0,2,0" value="0.0"/>
      <prob index="0,2,1" value="0.413161829979"/>
      <prob index="0,2,2" value="0.53565088819"/>
      <prob index="0,3,0" value="0.0"/>
      <prob index="0,3,1" value="0.0125167478399"/>
      <prob index="0,3,2" value="0.197914792348"/>
      <prob index="1,0,0" value="0.02094370746"/>
      <prob index="1,0,1" value="0.0893726873941"/>
      <prob index="1,0,2" value="0.0213412687401"/>
      <prob index="1,1,0" value="0.052325511844"/>
      <prob index="1,1,1" value="0.366747891062"/>
      <prob index="1,1,2" value="0.101698119121"/>
      <prob index="1,2,0" value="0.00408885441059"/>
      <prob index="1,2,1" value="0.266343762304"/>
      <prob index="1,2,2" value="0.0895159570299"/>
      <prob index="1,3,0" value="0.0"/>
      <prob index="1,3,1" value="0.0745946181248"/>
      <prob index="1,3,2" value="0.0594738888187"/>
      <prob index="2,0,0" value="0.00387002500515"/>
      <prob index="2,0,1" value="0.0166886226662"/>
      <prob index="2,0,2" value="0.00387033305138"/>
      <prob index="2,1,0" value="0.00287818577115"/>
      <prob index="2,1,1" value="0.0132765075529"/>
      <prob index="2,1,2" value="0.00307492553452"/>
      <prob index="2,2,0" value="0.00316867925666"/>
      <prob index="2,2,1" value="0.0304682785545"/>
      <prob index="2,2,2" value="0.00721216939155"/>
      <prob index="2,3,0" value="0.0"/>
      <prob index="2,3,1" value="0.0"/>
      <prob index="2,3,2" value="0.0"/>
    </disaggMatrix>
    <disaggMatrix type="Lon,Lat" dims="2,1" poE="0.1" iml="0.0311513188906">
      <prob index="0,0" value="0.998516831066"/>
      <prob index="1,0" value="0.0"/>
    </disaggMatrix>
    <disaggMatrix type="Mag,Lon,Lat" dims="3,2,1" poE="0.1" iml="0.0311513188906">
      <prob index="0,0,0" value="0.994069447605"/>
      <prob index="0,1,0" value="0.0"/>
      <prob index="1,0,0" value="0.727650754029"/>
      <prob index="1,1,0" value="0.0"/>
      <prob index="2,0,0" value="0.0817323260609"/>
      <prob index="2,1,0" value="0.0"/>
    </disaggMatrix>
    <disaggMatrix type="Lon,Lat,TRT" dims="2,1,1" poE="0.1" iml="0.0311513188906">
      <prob index="0,0,0" value="0.998516831066"/>
      <prob index="1,0,0" value="0.0"/>
    </disaggMatrix>
  </disaggMatrices>
</nrml>
"""
