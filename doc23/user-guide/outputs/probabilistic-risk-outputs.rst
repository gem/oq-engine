Probabilistic Risk Outputs
==========================

Probabilistic risk calculations can be run using either the Classical Probabilistic Risk Calculator or the Stochastic 
Event-Based Probabilistic Risk Calculator. The following set of outputs is generated by both calculators:

1. ``loss_curves``: loss exceedance curves describe the probabilities of exceeding a set of loss ratios or loss values, within a given time span (or investigation interval).
2. ``loss_maps``: loss maps describe the loss (``value``) that is exceeded at the selected probability of exceedance (``PoE``) within the specified time period for all assets at each of the unique locations in the *Exposure Model*.
3. ``avg_losses``: the average losses output describes the expected loss (``value``) within the time period specified by ``risk_investigation_time`` for all assets in the *Exposure Model*.

In addition, with the Stochastic Event-Based Probabilistic Risk Calculator, it is also possible to calculate the 
following types of outputs:

1. ``agg_curves``: aggregate loss curves describe the exceedance probabilities for a set of loss values for the entire portfolio of assets defined in the *Exposure Model*.
2. ``losses_by_event``: an event loss table contains the aggregate loss across all assets in the *Exposure Model* for each of the simulated ruptures in the Stochastic Event Set.

Loss exceedance curves
----------------------

Loss exceedance curves describe the probabilities of exceeding a set of loss ratios or loss values, within a given time 
span (or investigation interval). Depending upon the type of calculator used and the options defined before running a 
probabilistic risk calculation, one or more of the sets of loss exceedance curves described in the following subsections 
will be generated for all loss types (amongst “structural”, “nonstructural”, “contents”, “occupants”, or 
“business_interruption”) for which a vulnerability model file was provided in the configuration file.

****************************
Asset loss exceedance curves
****************************

Individual asset loss exceedance curves for ground-up losses are always generated for the Classical Probabilistic Risk 
Calculator. On the other hand, individual asset loss exceedance curves are not generated for the Stochastic Event-Based 
Probabilistic Risk Calculator. These results are stored in a comma separate value (.csv) file as illustrated in the 
example shown in the table below.

Example of an asset loss curve output file

+-----------+---------------+----------+----------+
| **asset** | **loss_type** | **loss** | **poe**  |
+===========+===============+==========+==========+
| a1        | structural    | 0        | 1.00E+00 |
+-----------+---------------+----------+----------+
| a1        | structural    | 100      | 1.00E+00 |
+-----------+---------------+----------+----------+
| a1        | structural    | 400      | 8.43E-01 |
+-----------+---------------+----------+----------+
| a1        | structural    | 1000     | 4.70E-01 |
+-----------+---------------+----------+----------+
| a1        | structural    | 2000     | 1.78E-01 |
+-----------+---------------+----------+----------+
| a1        | structural    | 3300     | 7.31E-02 |
+-----------+---------------+----------+----------+
| a1        | structural    | 5000     | 3.30E-02 |
+-----------+---------------+----------+----------+
| a1        | structural    | 6700     | 1.68E-02 |
+-----------+---------------+----------+----------+
| a1        | structural    | 8000     | 1.01E-02 |
+-----------+---------------+----------+----------+
| a1        | structural    | 9000     | 6.62E-03 |
+-----------+---------------+----------+----------+
| a1        | structural    | 9600     | 4.95E-03 |
+-----------+---------------+----------+----------+
| a1        | structural    | 9900     | 4.12E-03 |
+-----------+---------------+----------+----------+
| a1        | structural    | 10000    | 3.86E-03 |
+-----------+---------------+----------+----------+

***************************
Mean loss exceedance curves
***************************

For calculations involving multiple hazard branches, mean asset loss exceedance curves are also generated for both the 
Classical Probabilistic Risk Calculator and the Stochastic Event-Based Probabilistic Risk Calculator (if the parameter 
“loss_ratios” is defined in the configuration file). The structure of the file is identical to that of the individual 
asset loss exceedance curve output file.

*******************************
Quantile loss exceedance curves
*******************************

For calculations involving multiple hazard branches, quantile asset loss exceedance curves can also be generated for 
both the Classical Probabilistic Risk Calculator and the Stochastic Event-Based Probabilistic Risk Calculator (if the 
parameter “loss_ratios” is defined in the configuration file). The quantiles for which loss curves will be calculated 
should have been defined in the job configuration file for the calculation using the parameter ``quantiles``. The structure 
of the file is identical to that of the individual asset loss exceedance curve output file.

********************************
Aggregate loss exceedance curves
********************************
Aggregate loss exceedance curves are generated by the Stochastic Event- Based Probabilistic Risk and Damage Calculators and 
describe the probabilities of exceedance of the total loss across the entire portfolio for a set of loss values within 
a given time span (or investigation interval). These results are exported in a comma separate value (.csv) file as 
illustrated in the example shown in the table below.

Example of an aggregate loss curve

+---------------+------------+--------------+------------+----------------+----------------+----------------+-----------------+
| return_period | loss_type  | loss_value   | loss_ratio | loss_aep_value | loss_aep_ratio | loss_oep_value | loss_oep_ratio  |
+===============+============+==============+============+================+================+================+=================+
| 5             | contents   |  44,521      |  0.00      |  38,246        |  0.00          |  34,219        |  0.00           |
| 10            | contents   |  145,728     |  0.00      |  147,438       |  0.00          |  133,255       |  0.00           |
| 50            | contents   |  1,089,660   |  0.01      |  1,131,780     |  0.01          |  1,079,460     |  0.01           |
| 100           | contents   |  2,230,890   |  0.03      |  2,298,660     |  0.03          |  2,219,140     |  0.03           |
| 250           | contents   |  4,833,700   |  0.06      |  4,897,220     |  0.06          |  4,830,930     |  0.06           |
| 500           | contents   |  7,112,200   |  0.09      |  7,186,870     |  0.09          |  7,112,200     |  0.09           |
| 1000          | contents   |  9,191,950   |  0.12      |  9,275,310     |  0.12          |  9,191,950     |  0.12           |
| 5             | structural |  59,395      |  0.00      |  50,099        |  0.00          |  45,060        |  0.00           |
| 10            | structural |  202,690     |  0.00      |  203,687       |  0.00          |  184,959       |  0.00           |
| 50            | structural |  1,574,750   |  0.01      |  1,634,230     |  0.02          |  1,560,150     |  0.01           |
| 100           | structural |  3,241,610   |  0.03      |  3,317,090     |  0.03          |  3,225,950     |  0.03           |
| 250           | structural |  7,184,770   |  0.07      |  7,284,890     |  0.07          |  7,182,080     |  0.07           |
| 500           | structural |  10,548,100  |  0.10      |  10,678,600    |  0.10          |  10,548,100    |  0.10           |
| 1000          | structural |  13,636,500  |  0.13      |  13,776,700    |  0.13          |  13,636,500    |  0.13           |
| ...           | ...        |  ...         |            |  ...           |  ...           |   ...          |  ...            |
+---------------+------------+--------------+------------+----------------+----------------+----------------+-----------------+

where ``loss_value`` and ``loss_ratio`` corresponds to the aggregated loss curves and ratios considering each event individually

Same as described previously for individual assets, mean aggregate loss exceedance curves and quantile aggregate loss 
exceedance curves will also be generated when relevant.


Probabilistic loss maps
-----------------------

A probabilistic loss map contains the losses that have a specified probability of exceedance within a given time span 
(or investigation interval) throughout the region of interest. This result can be generated using either the Stochastic 
Event-Based Probabilistic Risk Calculator or the Classical Probabilistic Risk Calculator.

The file snippet included in the table below shows an example probabilistic loss map output file.

Example of a probabilistic loss map output file

+---------------+--------------+----------+---------+-------------------------+------------------------+
| **asset_ref** | **taxonomy** | **lon**  | **lat** | **structural poe-0.02** | **structural poe-0.1** |
+===============+==============+==========+=========+=========================+========================+
| a1            | wood         | -122.000 | 38.113  | 6,686.10                | 3,241.80               |
+---------------+--------------+----------+---------+-------------------------+------------------------+
| a2            | concrete     | -122.114 | 38.113  | 597.59                  | 328.07                 |
+---------------+--------------+----------+---------+-------------------------+------------------------+
| a3            | wood         | -122.570 | 38.113  | 251.73                  | 136.64                 |
+---------------+--------------+----------+---------+-------------------------+------------------------+
| a4            | steel        | -122.000 | 38.000  | 3,196.66                | 1,610.98               |
+---------------+--------------+----------+---------+-------------------------+------------------------+
| a5            | wood         | -122.000 | 37.910  | 949.26                  | 431.26                 |
+---------------+--------------+----------+---------+-------------------------+------------------------+
| a6            | concrete     | -122.000 | 38.225  | 1,549.72                | 577.30                 |
+---------------+--------------+----------+---------+-------------------------+------------------------+
| a7            | wood         | -121.886 | 38.113  | 1,213.54                | 677.16                 |
+---------------+--------------+----------+---------+-------------------------+------------------------+

Stochastic event loss tables
----------------------------

The Stochastic Event-Based Probabilistic Risk Calculator will also produce an aggregate event loss table. Each row of 
this table contains the rupture id, and aggregated loss (sum of the losses from the collection of assets within the 
region of interest), for each event in the stochastic event sets. The rupture id listed in this table is linked with 
the rupture ids listed in the stochastic event sets files.

The file snippet included in the table below shows an example stochastic event loss table output file.

Example aggregate event loss table

+--------------+------------+----------+----------------+
| **event_id** | **rup_id** | **year** | **structural** |
+==============+============+==========+================+
| 0            | 486        | 8        | -              |
+--------------+------------+----------+----------------+
| 1            | 486        | 8        | -              |
+--------------+------------+----------+----------------+
| 2            | 486        | 8        | 375.12         |
+--------------+------------+----------+----------------+
| 3            | 486        | 8        | 177.71         |
+--------------+------------+----------+----------------+
| 4            | 486        | 12       | 173.75         |
+--------------+------------+----------+----------------+
| 5            | 486        | 12       | 200.51         |
+--------------+------------+----------+----------------+
| 6            | 486        | 12       | 267.50         |
+--------------+------------+----------+----------------+
| 7            | 486        | 12       | 196.72         |
+--------------+------------+----------+----------------+
| 8            | 785        | 12       | 4,720.67       |
+--------------+------------+----------+----------------+
| 9            | 785        | 12       | 1,002.59       |
+--------------+------------+----------+----------------+
| 10           | 785        | 12       | 6,693.98       |
+--------------+------------+----------+----------------+
| 11           | 785        | 12       | 1,135.40       |
+--------------+------------+----------+----------------+
| 12           | 483        | 13       | 111.85         |
+--------------+------------+----------+----------------+
| ...          | ...        | ...      | ...            |
+--------------+------------+----------+----------------+

Asset event loss tables provide calculated losses for each of the assets in the exposure model, for each event within 
the stochastic event sets. Considering that the amount of data usually contained in an asset event loss table is 
substantial, this table is not generated by default and even when it is generated it cannot be exported: it can only be 
accessed programmatically from the datastore. It is there for debugging purposes only.