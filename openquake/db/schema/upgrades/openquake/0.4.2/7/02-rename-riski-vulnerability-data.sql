/*

    Copyright (c) 2010-2011, GEM Foundation.

    OpenQuake database is made available under the Open Database License:
    http://opendatacommons.org/licenses/odbl/1.0/. Any rights in individual
    contents of the database are licensed under the Database Contents License:
    http://opendatacommons.org/licenses/dbcl/1.0/

*/

-- renaming the table itself
ALTER TABLE riski.vulnerability_data
    RENAME TO vulnerability_function;


-- the primary key sequence
ALTER SEQUENCE riski.vulnerability_data_id_seq
    RENAME TO vulnerability_function_id_seq;


-- index
ALTER INDEX riski.vulnerability_data_pkey
    RENAME TO vulnerability_function_pkey;


-- constraint (postgres doesn't support renaming constraints)
ALTER TABLE riski.vulnerability_function
    DROP CONSTRAINT riski_vulnerability_data_vulnerability_model_fk;

ALTER TABLE riski.vulnerability_function
    ADD CONSTRAINT riski_vulnerability_function_vulnerability_model_fk
        FOREIGN KEY (vulnerability_model_id)
        REFERENCES riski.vulnerability_model(id)
        ON DELETE CASCADE;

-- trigger
ALTER TRIGGER riski_vulnerability_data_refresh_last_update_trig
    ON riski.vulnerability_function
    RENAME TO riski_vulnerability_function_refresh_last_update_trig;
